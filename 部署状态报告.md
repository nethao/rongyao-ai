# 荣耀AI审核发布系统 - 部署状态报告

## 项目概述

这是一个AI驱动的文章审核和自动发布系统，支持从邮箱抓取文章、通过AI审核并发布到多个WordPress站点。

## 当前部署状态

### 运行服务

| 服务名 | 容器名 | 端口 | 状态 |
|--------|--------|------|------|
| Nginx反向代理 | nginx_proxy | 80, 443 | 运行中 |
| 后端API | rongyao-ai_backend_1 | 8000 | 运行中 |
| 前端 | rongyao-ai_frontend_1 | 3000 | 运行中 |
| Celery Worker | rongyao-ai_celery_worker_1 | - | 运行中 |
| PostgreSQL数据库 | rongyao-ai_db_1 | 5432 | 运行中 |
| Redis | rongyao-ai_redis_1 | 6379 | 运行中 |
| WordPress A | wp_a | 80 | 运行中 |
| WordPress B | wp_b | 80 | 运行中 |
| WordPress C | wp_c | 80 | 运行中 |
| WordPress D | wp_d | 80 | 运行中 |
| MySQL(WordPress) | wp_db | 3306 | 运行中 |

### 域名绑定

| 域名 | 服务 | 说明 |
|------|------|------|
| a.com | wp_a | WordPress站点A |
| b.com | wp_b | WordPress站点B |
| c.com | wp_c | WordPress站点C |
| d.com | wp_d | WordPress站点D |
| e.com | frontend | rongyao-ai前端界面 |

**测试机hosts文件配置示例：**
```
服务器IP a.com b.com c.com d.com e.com
```

### WordPress站点配置

| 站点ID | 名称 | URL | 应用程序密码 | 状态 |
|--------|------|-----|--------------|------|
| - | 争先测试 | http://c.com | (已加密存储) | 已配置 |
| - | 政企测试 | http://d.com | (已加密存储) | 已配置 |

**注意：** A站点和B站点需通过前端界面 http://e.com 添加。

### 系统账号

- **rongyao-ai管理后台**
  - 地址：http://e.com
  - 账号：admin
  - 密码：admin123

- **WordPress站点**
  - A站点：http://a.com/wp-admin
  - B站点：http://b.com/wp-admin
  - C站点：http://c.com/wp-admin
  - D站点：http://d.com/wp-admin

- **数据库**
  - PostgreSQL：postgresql://postgres:password@localhost:5432/glory_audit
  - MySQL：mysql://root:root_password@localhost:3306

## 项目目录结构

```
/home/nethao/rongyao-ai/
├── backend/                    # 后端代码 (FastAPI)
│   ├── app/
│   │   ├── api/               # API路由
│   │   │   ├── auth.py        # 认证接口
│   │   │   ├── config.py      # 配置接口
│   │   │   ├── drafts.py      # 草稿接口
│   │   │   ├── monitoring.py  # 监控接口
│   │   │   ├── submissions.py # 投稿接口
│   │   │   └── wordpress_sites.py # WP站点接口
│   │   ├── models/            # 数据模型
│   │   │   ├── draft.py
│   │   │   ├── submission.py
│   │   │   ├── user.py
│   │   │   ├── wordpress_site.py
│   │   │   └── system_config.py
│   │   ├── schemas/           # Pydantic schemas
│   │   ├── services/          # 业务逻辑
│   │   │   ├── auth_service.py
│   │   │   ├── config_service.py
│   │   │   ├── draft_service.py
│   │   │   ├── llm_service.py
│   │   │   ├── publish_service.py
│   │   │   ├── wordpress_service.py
│   │   │   └── wordpress_site_service.py
│   │   ├── utils/            # 工具函数
│   │   │   ├── auth.py       # 认证工具
│   │   │   ├── encryption.py # 加密工具
│   │   │   └── permissions.py # 权限检查
│   │   ├── config.py         # 配置管理
│   │   ├── database.py       # 数据库连接
│   │   ├── main.py           # 应用入口
│   │   └── tasks.py          # Celery任务
│   ├── alembic/              # 数据库迁移
│   ├── scripts/
│   │   └── init_admin.py     # 初始化管理员脚本
│   ├── requirements.txt
│   └── .env                  # 环境变量
│
├── frontend/                  # 前端代码 (Vue3 + Vite)
│   ├── src/
│   │   ├── api/              # API调用
│   │   ├── components/       # 组件
│   │   ├── views/           # 页面视图
│   │   ├── stores/          # Pinia状态管理
│   │   ├── router/          # 路由配置
│   │   └── main.js          # 入口文件
│   ├── index.html
│   ├── vite.config.js        # Vite配置
│   └── package.json
│
├── docker/                    # Docker配置
│   ├── backend/
│   │   └── Dockerfile
│   └── frontend/
│       └── Dockerfile
│
├── nginx.conf                # Nginx反向代理配置
├── docker-compose.yml        # Docker Compose编排
├── README.md
├── DEPLOYMENT_CHECKLIST.md
└── IMPLEMENTATION_SUMMARY.md
```

## 待完成配置

### 1. OpenAI API Key（必需）

编辑 `backend/.env` 文件，修改以下配置：

```env
OPENAI_API_KEY=sk-your-actual-openai-api-key
```

然后重启后端：
```bash
sudo docker-compose restart backend
```

### 2. 添加A和B站点

访问 http://e.com 登录后，在WordPress站点管理页面添加：

- **A站点**
  - 名称：荣耀测试
  - URL：http://a.com
  - 应用程序密码：u7Nt MC6n V6g4 xBTk 2oTQ EvHo
  - 用户名：admin

- **B站点**
  - 名称：争先测试
  - URL：http://b.com
  - 应用程序密码：IXaIXam ukgl 6d6i K5kZ Sjog lZx1
  - 用户名：admin

### 3. 阿里云OSS配置（可选）

如果需要图片上传功能，需要配置：

```env
OSS_ACCESS_KEY_ID=your-oss-access-key-id
OSS_ACCESS_KEY_SECRET=your-oss-access-key-secret
OSS_ENDPOINT=oss-cn-hangzhou.aliyuncs.com
OSS_BUCKET_NAME=your-bucket-name
```

### 4. 邮箱配置（可选）

如果需要邮箱投稿功能：

```env
IMAP_HOST=imap.example.com
IMAP_PORT=993
IMAP_USER=your-email@example.com
IMAP_PASSWORD=your-email-password
IMAP_USE_SSL=true
```

## 常用命令

```bash
# 查看所有容器状态
sudo docker-compose ps

# 查看后端日志
sudo docker-compose logs -f backend

# 重启所有服务
sudo docker-compose restart

# 停止所有服务
sudo docker-compose down

# 启动所有服务
sudo docker-compose up -d

# 重新构建并启动
sudo docker-compose up -d --build
```

## API文档

- 后端API文档：http://localhost:8000/docs
- 或通过e.com访问：http://e.com/docs

## 已知问题

1. **bcrypt版本兼容性**：需要使用 bcrypt==4.0.1 版本，否则密码验证会报错
2. **WordPress应用程序密码**：需在wp-config.php中添加 `define( 'WP_ENVIRONMENT_TYPE', 'local' );` 才能显示应用程序密码选项
3. **Cookie问题**：部分WordPress站点可能需要添加 `define( 'COOKIE_DOMAIN', $_SERVER['HTTP_HOST'] );`

## 项目技术栈

- **前端**：Vue 3 + Vite + Pinia + Vue Router
- **后端**：FastAPI + SQLAlchemy + Pydantic
- **数据库**：PostgreSQL 15
- **缓存**：Redis
- **任务队列**：Celery
- **WordPress**：最新版本 × 4
- **反向代理**：Nginx

---
*报告生成时间：2026-02-14*
